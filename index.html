<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Kill it With Fire 2 Mosaic</title>
	<style>
		body {
			background: #111;
			color: white;
			font-family: Arial;
			margin: 20px;
		}

		canvas {
			border: 1px solid #444;
			image-rendering: pixelated;
			display: block;
			margin-bottom: 220px;
		}

		/* Scale secondary canvas ×4 */
		#secondaryCanvas {
			transform: scale(4);
			transform-origin: top left;
		}

		.panel {
			margin-top: 20px;
			padding: 15px;
			background: #222;
			border-radius: 8px;
			width: 420px;
		& input,
		select,
		button {
			width: 100%;
			padding: 6px;
			margin-top: 4px;
			margin-bottom: 6px;
			border-radius: 6px;
			border: 1px solid #555;
			background: #333;
			color: white;
		}

		& button {
			background: #444;
			cursor: pointer;
			font-weight: bold;
		}
		}


		.color-container {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.color-preview {
			display: inline-block;
			width: 20px;
			height: 20px;
			border: 1px solid #555;
		}
		.keaypad-wrapper{
			display: flex;
			flex-direction: column;
			width: fit-content;
			gap: 0.5rem;
			padding: 0.5rem;
			padding: 1rem;
			border-radius: 15px;
			background-color: #222;
			
			&>input {
				width: 1fr;
				padding: 0.5rem;
				font-size: 1.2rem;
				border-radius: 10px;
				border: 1px solid #555;
				background-color: #333;
				color: white;
				overflow: scroll;
			}
			margin: 15px;
		}
		.rune-keypad {
			display: grid;
			grid-template-columns: repeat(3, auto);
			width: fit-content;
			gap: 0.2rem;
			


			&>button {
				height: 6rem;
				width: 6rem;
				aspect-ratio: 1;
				font-size: 1.5rem;
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 0.1rem;
				background-color: #333;
				border-style: none;

				&>img {
					pointer-events: none;
					aspect-ratio: 1;
					height: 100%;
				}
				&:hover {
					background-color: #444;

					&>img {
						filter: brightness(1.2);
					}
				}
				&:active {
					background-color: #555;

					&>img {
						filter: brightness(0.8);
					}
				}
			}

		}
		#statusMessageField {
			display: flex;
			justify-self: center;;
			border-style: solid;
			border-color: #fff;
			background-color: #000;
			color: #888;
			width: 80%;

			&.good {
				color: #0f0;
			}
			&.fine {
				color: #ff0;
			}
			&.bad {
				color: #f00;
			}
		}
		.step { background:#222; padding:12px; border-radius:8px; margin-bottom:12px; width:420px; }
    .step h3 { margin:0 0 8px 0; font-size:18px; }
    .step ul { margin:0; padding-left:18px; }
    .step li { margin:6px 0; }
	</style>
</head>

<body>

	<h1> THE RECIPE HAS BEEN FOUND</h1>
 <div class="step" id="step-1">
    <h3>Step 1</h3>
    <ul>
      <li><span class="label">Heat:</span> 2</li>
      <li><span class="label">Add:</span> 3 normal spiders, 2 jumping spiders, 1 web</li>
      <li><span class="label">Action:</span> Stir</li>
    </ul>
  </div>

  <div class="step" id="step-2">
    <h3>Step 2</h3>
    <ul>
      <li><span class="label">Heat:</span> 0</li>
      <li><span class="label">Add:</span> golden trophy</li>
      <li><span class="label">Action:</span> Don’t stir</li>
    </ul>
  </div>

  <div class="step" id="step-3">
    <h3>Step 3</h3>
    <ul>
      <li><span class="label">Heat:</span> 4</li>
      <li><span class="label">Add:</span> bullet ammo, fire ammo, heavy ammo</li>
      <li><span class="label">Action:</span> Stir</li>
    </ul>
  </div>

  <div class="step" id="step-4">
    <h3>Step 4</h3>
    <ul>
      <li><span class="label">Heat:</span> 1</li>
      <li><span class="label">Add:</span> 3 nuke puff</li>
      <li><span class="label">Action:</span> Stir</li>
    </ul>
  </div>

	<h2> What we know so far</h2>
	There are 12 locations where runes can spawn, shown below : <br>
	<img src="./img/Rune_Cheatsheet.png"><br>
	Bringing a blue torch to those spot will reveal symbols (The number of and symbols are random per player), some of
	which will be colored<br>
	<img src="./img/blueTorch.png" width="500px" height="200px"><br>
	Each Symbol corresponds to a number, delimited by the number of bump on that seal in the portal in front of the
	spider god's door, as shown below : <br>
	<img src="./img/symbolNumbers.png" width="500px" height="300px"><br>
	With this in mind, each colored rune is actually an X/Y coordinate and a color : <br>
	<img src="./img/symbolCoordinate.png" width="500px" height="200px"><br>
	The current theory is that by plotting these symbols, we can get an image that will help us unlock the "Cheat Code"
	item<br>




	<h2>Kill it With Fire 2 Mosaic</h2>
	For each of your Runes (including black), enter the X and Y coordinate of the pixel, along with the color, and press
	"Submit"<br>

	<!-- PRIMARY CANVAS REMOVED -->
	<!-- <canvas id="pixelCanvas" width="777" height="77"></canvas> -->
	<sub>Note : Coordinates are interpreted as octal for rendering purposes </sub>
	<canvas id="secondaryCanvas" width="128" height="64"></canvas>

	<div class="panel">
		<label>Color (If you are unsure, a reference chart is available below):</label>
		<div class="color-container">
			<select id="colorSelect">
				<option value="#ff0000">Red</option>
				<option value="#FFC0CB">Pink</option>
				<option value="#895129">Brown</option>
				<option value="#FFA500">Orange</option>
				<option value="#ffff00">Yellow</option>
				<option value="#00ff00">Green</option>
				<option value="#0000ff">Blue</option>
				<option value="#800080">Purple</option>
				<option value="#000000">Black</option>
				<option value="#ffffff">White</option>

			</select>
			<span class="color-preview" id="colorPreview"></span>
		</div>


		<label for="xInput">X:</label>
		<input id="xInput" type="number" min="0" max="776">


		<label for="yInput">Y:</label>
		<input id="yInput" type="number" min="0" max="76">


		<button id="submitBtn">Submit Pixel</button>
		<span id="statusMessageField">Submit Status</span>
	</div>

	<script>
		function onRunePress(num) {
			const input = document.getElementById("rune-keypad-number");
			input.value += num;
		}
	</script>

	<br>
	If you don't want to translate the runes to numbers yourself, you can use the Rune Keypad™ below:
	<div class="keaypad-wrapper">
		<label for="rune-keypad-number">Rune Keypad™:</label>
		<input type="number" name="rune-keypad-out" id="rune-keypad-number">
		<div class="rune-keypad">
			<button onclick="onRunePress(1)"><img src="./img/Rune1.png" alt="Rune 1"></button>
			<button onclick="onRunePress(2)"><img src="./img/Rune2.png" alt="Rune 2"></button>
			<button onclick="onRunePress(3)"><img src="./img/Rune3.png" alt="Rune 3"></button>
			<button onclick="onRunePress(4)"><img src="./img/Rune4.png" alt="Rune 4"></button>
			<button onclick="onRunePress(5)"><img src="./img/Rune5.png" alt="Rune 5"></button>
			<button onclick="onRunePress(6)"><img src="./img/Rune6.png" alt="Rune 6"></button>
			<button onclick="onRunePress(7)"><img src="./img/Rune7.png" alt="Rune 7"></button>
			<button onclick="onRunePress(0)"><img src="./img/Rune0.png" alt="Rune 0"></button>
			<button onclick="document.getElementById('rune-keypad-number').value = ''">Clear</button>
		</div>
	</div>
	<br>
	Color Chart Reference : <br>
	<img src="./img/colorRef.png" width="500px" height="300px">
	<br>

	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.34.0/dist/umd/supabase.min.js"></script>
	<script>
		const W = 777, H = 77;

		/* PRIMARY CANVAS REMOVED */
		// const canvas = document.getElementById("pixelCanvas");
		// const ctx = canvas.getContext("2d");

		const secondaryCanvas = document.getElementById("secondaryCanvas");
		const sctx = secondaryCanvas.getContext("2d");

		const colorSelect = document.getElementById("colorSelect");
		const colorPreview = document.getElementById("colorPreview");
		const xInput = document.getElementById("xInput");
		const yInput = document.getElementById("yInput");
		const submitBtn = document.getElementById("submitBtn");
		const statusMessageField = document.getElementById("statusMessageField");


		// Secondary canvas background
		sctx.fillStyle = "#808080";
		sctx.fillRect(0, 0, W, H);

		// Show initial color
        colorPreview.style.backgroundColor = colorSelect.value;

        colorSelect.addEventListener('change', () => {
            colorPreview.style.backgroundColor = colorSelect.value;
        });

        // INLINE LIVE UPDATE (added)
        colorSelect.addEventListener("input", () => {
            colorPreview.style.backgroundColor = colorSelect.value;
        });



		// --- Supabase setup ---
		const SUPABASE_URL = "https://uqsulkecdpzwacktcwut.supabase.co";
		const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVxc3Vsa2VjZHB6d2Fja3Rjd3V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwOTgxMjEsImV4cCI6MjA3OTY3NDEyMX0.-4safUVuOJayX_D15q1GmPYiHVSzIW2Zmc833o303W8";
		const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);


		// Secondary canvas loader
		async function loadSecondaryCanvas() {
			const { data, error } = await supabaseClient.from("pixels").select("*");
			if (error) { console.error(error); return; }

			data.forEach(p => {
				const xDec = parseInt(p.x, 8);
				const yDec = parseInt(p.y, 8);
				if (isNaN(xDec) || isNaN(yDec) || xDec < 0 || xDec >= W || yDec < 0 || yDec >= H) return;
				sctx.fillStyle = p.color;
				sctx.fillRect(xDec, yDec, 1, 1);
			});
		}
		loadSecondaryCanvas();



		// Submit (still writes to DB)
		submitBtn.onclick = async () => {
			const x = parseInt(xInput.value);
			const y = parseInt(yInput.value);
			const color = colorSelect.value;

			if (isNaN(x) || isNaN(y) || x < 0 || x >= W || y < 0 || y >= H) {
				alert("Invalid coordinates");
				return;
			}

			const { data, error, status } = await supabaseClient
				.from("pixels")
				.upsert({ x, y, color }, { onConflict: ['x', 'y'] });

			if (status === 200 || status === 201) {
				statusMessageField.textContent = `Pixel at (${x}, ${y}) submitted successfully!`;
				statusMessageField.className = "good";
			} else if (status === 409) {
				statusMessageField.textContent = `Pixel at (${x}, ${y}) already exists.`;
				statusMessageField.className = "fine";
			} else {
				statusMessageField.textContent = `Error submitting pixel: ${status}`;
				statusMessageField.className = "bad";
			}

			if (error) console.error("Supabase upsert error:", error);
		};
		
		// Optional: subscribe to realtime updates (requires Realtime enabled on table)
		supabaseClient.channel('realtime-pixels')
		.on('postgres_changes', { event: '*', schema: 'public', table: 'pixels' }, payload => {
			const p = payload.new;
			sctx.fillStyle = p.color;
			sctx.fillRect(p.x, p.y, 1, 1);
		})
		.subscribe();


	</script>
</body>

</html>
